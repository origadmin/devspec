# 代码审查规范 (Code Review Guidelines)

## 目的

代码审查是软件开发过程中不可或缺的一部分，旨在通过团队协作来提高代码质量、发现潜在问题、分享知识并促进最佳实践的采用。本规范为团队成员提供了一套统一、具体且可操作的代码审查标准，确保每次审查都能达到预期效果。

## 角色与职责

- **提交者 (Author)**:
    - 在提交审查前，必须依据下文的“审查清单”进行自查。
    - 确保合并请求（MR/PR）的描述清晰，解释了“做了什么”、“为什么做”以及“如何测试”。
    - 对于审查者的每一个评论（comment），都必须回复（例如：接受、拒绝并说明理由、或提出疑问）。

- **审查者 (Reviewer)**:
    - **首要职责**：保证代码库的整体质量和健康度。
    - 优先关注架构设计、逻辑正确性、并发安全和测试覆盖率等高层次问题。
    - 对于代码风格等可以通过 `gofmt` 或 linter 自动解决的问题，可以提出，但不必花费过多精力。
    - 提出建议时，尽量提供具体的代码示例或修改方案。
    - 保持尊重和建设性的沟通态度。

## 审查清单 (Review Checklist)

为了确保审查的全面性，审查者和提交者都应检查以下清单。建议提交者在提交 MR/PR 时，将此清单附在描述中，并勾选已自我检查的项目。

### 功能与逻辑

- [ ] **需求满足**: 代码是否完整实现了预定的功能需求？
- [ ] **逻辑正确**: 实现逻辑是否存在明显缺陷？（例如，算法错误、逻辑判断不完整）
- [ ] **边界处理**: 是否正确处理了各种边界条件？（例如，nil 指针、空切片/map、索引越界、数值溢出）
- [ ] **错误处理**:
    - [ ] 是否对所有可能返回 `error` 的函数都进行了检查？
    - [ ] 错误信息是否清晰，是否向上传递了足够的上下文？（推荐使用 `fmt.Errorf("module: message: %w", err)`）
    - [ ] 是否避免了使用 `_` 丢弃错误？
- [ ] **并发安全**:
    - [ ] 对于并发访问的共享资源（全局变量、map、slice 等），是否使用了锁（`sync.Mutex`）或其他并发安全机制？
    - [ ] 是否有潜在的死锁风险？
    - [ ] goroutine 是否有明确的退出机制，避免泄露？

### 代码质量与规范

- [ ] **命名规范**: 命名是否清晰并遵循了 **[编码规范 (go-coding.md)](./go-coding.md)**？（例如，变量名、函数名、包名）
- [ ] **结构清晰**:
    - [ ] 函数是否遵循“单一职责”原则？是否存在超过 100 行的超长函数？
    - [ ] 是否有不合理的深度嵌套（`if/for` 超过 3 层）？
    - [ ] 是否可以将复杂逻辑拆分为更小的辅助函数？
- [ ] **代码复用**: 是否有重复的“代码块”可以被抽象成公共函数或方法？
- [ ] **注释质量**:
    - [ ] 公共函数、结构体、接口和复杂逻辑块是否都有清晰的注释？
    - [ ] 注释是否解释了“为什么”这么做，而不仅仅是“做了什么”？
- [ ] **依赖管理**: 引入的第三方依赖是否是必需的？是否有更轻量的替代方案？

### 测试

- [ ] **单元测试**: 核心逻辑和公共函数是否都有对应的单元测试？
- [ ] **测试覆盖率**: 测试是否覆盖了主要的成功路径和常见的失败路径？
- [ ] **测试用例**: 测试用例是否易于理解和维护？（推荐使用表驱动测试）

### 项目特定规范

- [ ] **接口定义**: 如果新增或修改了 `runtime/interfaces` 下的接口，是否考虑了其通用性和扩展性？
- [ ] **上下文使用**: 是否正确地传递和使用了 `context.Context`？
- [ ] **提交信息**: Commit Message 是否严格遵循了 **[提交规范 (commit.md)](./commit.md)**？

## 审查后反馈

- **建设性反馈**：提出的问题和建议应具体且具有建设性，避免模糊或负面的评论。
- **尊重作者**：尊重代码作者的工作，保持友好和专业的态度，共同解决问题。
- **及时响应**：尽量在合理的时间内完成审查并给出反馈，避免长时间等待影响开发进度。

## 工具支持

为了提高代码审查的效率和准确性，推荐使用以下工具：

- **静态分析工具**：如 `golangci-lint`、`go vet`、`staticcheck` 等，用于检测代码中的潜在问题。
- **格式化工具**：如 `gofmt`、`goimports`，确保代码格式一致。
- **代码审查平台**：如 GitHub、GitLab、Bitbucket 等，提供便捷的 PR 和评论功能。
- **持续集成工具**：如 Jenkins、Travis CI、CircleCI 等，自动运行测试和构建任务。